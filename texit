# Script to autocompile latex documents
# by detecting a change in filebasename status.

# Author: Oliver Chauncey Gorton

# Counting variables
stattime=0 
compiles=0
slptime=1.0 # Time to wait between status checks

#Get user filebasename from command line
filebasename=$1 

#No filebasename found on command line, request from user.
if [ $# -eq 0 ]
then
	echo "Please provide an input .tex file (ommit .tex)":
	read filebasename
fi

# Echo inputs
echo Input:   $filebasename

# Check for existence of file
if [[ -f "$filebasename.tex" ]]
then
    filebasename=$filebasename'.tex'
    echo Texing: $filebasename
else
    echo "$filebasename.tex not found"
    return 1
fi
# Initialize
stattime=($(stat -c %Z $filebasename))
while true; do

        stattimenew=($(stat -c %Z $filebasename))

        # Detect change in source filebasename
        if [ $stattimenew -ne $stattime ]
	then
	        if { # try double compile
		    echo "Compiling..."
                    pdflatex -halt-on-error ./$filebasename > texit.log;
                    pdflatex -halt-on-error ./$filebasename > texit.out;
                } 
		then { # success
                    echo "Compile success at "$(date);
                    ((compiles++))
                    rm *.log *.aux
                }
                else  { # catch
                    echo "Compile failed."
                }
                fi
                echo "Compiles: $compiles"
	fi

        stattime=$stattimenew
	sleep $slptime

done
